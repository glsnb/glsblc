{"remainingRequest":"/Users/apple/github/glsnb/glsblc/glsblc/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/apple/github/glsnb/glsblc/glsblc/node_modules/form-generator-iview/src/fields/fieldUpload.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/apple/github/glsnb/glsblc/glsblc/node_modules/form-generator-iview/src/fields/fieldUpload.vue","mtime":1576581289804},{"path":"/Users/apple/github/glsnb/glsblc/glsblc/node_modules/cache-loader/dist/cjs.js","mtime":1576575745336},{"path":"/Users/apple/github/glsnb/glsblc/glsblc/node_modules/thread-loader/dist/cjs.js","mtime":1575878146703},{"path":"/Users/apple/github/glsnb/glsblc/glsblc/node_modules/babel-loader/lib/index.js","mtime":1575878134225},{"path":"/Users/apple/github/glsnb/glsblc/glsblc/node_modules/cache-loader/dist/cjs.js","mtime":1576575745336},{"path":"/Users/apple/github/glsnb/glsblc/glsblc/node_modules/vue-loader/lib/index.js","mtime":1576575752870}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCgpleHBvcnQgZGVmYXVsdCB7CiAgICBpbmplY3Q6IFsnZm9ybSddLAogICAgcHJvcHM6IHsKICAgICAgICBmaWVsZDogewogICAgICAgICAgICB0eXBlOiBPYmplY3QsCiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgfSwKICAgICAgICBzaXplOiB7CiAgICAgICAgICAgIHR5cGU6IFN0cmluZywKICAgICAgICAgICAgZGVmYXVsdCgpIHsKICAgICAgICAgICAgICAgIHJldHVybiAnZGVmYXVsdCc7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgfSwKICAgIGRhdGEoKSB7CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgZGVmYXVsdEZpbGVMaXN0OiBbXSwKICAgICAgICAgICAgdXBsb2FkRmlsZUxpc3Q6IFtdLAogICAgICAgICAgICBsb2FkaW5nOiBmYWxzZSwKICAgICAgICAgICAgdXBsb2FkZXI6IG51bGwKICAgICAgICB9OwogICAgfSwKICAgIGNvbXB1dGVkOiB7CiAgICAgICAgdGlwKCkgewogICAgICAgICAgICByZXR1cm4gdGhpcy5maWVsZC50aXAgfHwgJ+eCueWHu+aIluiAheaLluaLveaWh+S7tuWNs+WPr+S4iuS8oCc7CiAgICAgICAgfSwKICAgICAgICB2YWx1ZSgpIHsKICAgICAgICAgICAgbGV0IHZhbHVlID0gdGhpcy5mb3JtLm1vZGVsW3RoaXMuZmllbGQubW9kZWxdIHx8IFtdOwogICAgICAgICAgICByZXR1cm4gdmFsdWUubWFwKGl0ZW0gPT4gewogICAgICAgICAgICAgICAgaXRlbS5zdGF0dXMgPSAnZmluaXNoZWQnOwogICAgICAgICAgICAgICAgcmV0dXJuIGl0ZW07CiAgICAgICAgICAgIH0pOwogICAgICAgIH0KICAgIH0sCiAgICB3YXRjaDogewogICAgICAgIHZhbHVlKHZhbHVlKSB7CiAgICAgICAgICAgIHRoaXMudXBsb2FkRmlsZUxpc3QgPSB2YWx1ZTsKICAgICAgICAgICAgaWYgKHRoaXMudXBsb2FkZXIpIHsKICAgICAgICAgICAgICAgIHRoaXMudXBsb2FkZXIuZmlsZUxpc3QgPSB0aGlzLnVwbG9hZEZpbGVMaXN0OwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgIH0sCiAgICBtb3VudGVkKCkgewogICAgICAgIHRoaXMudXBsb2FkZXIgPSB0aGlzLiRyZWZzLnVwbG9hZCB8fCB0aGlzLiRyZWZzLm1lZGlhVXBsb2FkLiRyZWZzLnVwbG9hZDsKICAgICAgICB0aGlzLnVwbG9hZGVyLmZpbGVMaXN0ID0gdGhpcy52YWx1ZTsKICAgICAgICB0aGlzLnVwbG9hZEZpbGVMaXN0ID0gdGhpcy51cGxvYWRlci5maWxlTGlzdDsKICAgICAgICAvLyB0aGlzLnVwbG9hZGVyLmZpbGVMaXN0ID0gdGhpcy51cGxvYWRGaWxlTGlzdDsKICAgIH0sCiAgICBtZXRob2RzOiB7CiAgICAgICAgaGFuZGxlQ2hhbmdlKCkgewogICAgICAgICAgICB0aGlzLiRzZXQodGhpcy5mb3JtLm1vZGVsLCB0aGlzLmZpZWxkLm1vZGVsLCB0aGlzLnVwbG9hZEZpbGVMaXN0KTsKICAgICAgICAgICAgdGhpcy4kZW1pdCgnb24tY2hhbmdlJywgdGhpcy5maWVsZC5tb2RlbCwgdGhpcy51cGxvYWRGaWxlTGlzdCwgbnVsbCwgdGhpcy5maWVsZCk7CiAgICAgICAgfSwKICAgICAgICBvblN1Y2Nlc3Moe2RhdGEgPSB7fX0sIGZpbGUpIHsKICAgICAgICAgICAgY29uc3Qge3VybH0gPSBkYXRhOwogICAgICAgICAgICBpZiAodXJsKSB7CiAgICAgICAgICAgICAgICB0aGlzLiRNZXNzYWdlLmluZm8oJ+S4iuS8oOaIkOWKnyEnKTsKICAgICAgICAgICAgICAgIGZpbGUudXJsID0gdXJsOwogICAgICAgICAgICAgICAgdGhpcy51cGxvYWRGaWxlTGlzdCA9IHRoaXMudXBsb2FkZXIuZmlsZUxpc3Quc2xpY2UoKTsKICAgICAgICAgICAgICAgIHRoaXMuaGFuZGxlQ2hhbmdlKCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgICAgICB0aGlzLiRNZXNzYWdlLmVycm9yKCfkuIrkvKDlpLHotKUhJyk7CiAgICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIG9uRm9ybWF0RXJyb3IoKSB7CiAgICAgICAgICAgIHRoaXMuJE1lc3NhZ2UuZXJyb3IoewogICAgICAgICAgICAgICAgY29udGVudDogYOS4iuS8oOaWh+S7tuagvOW8j+mcgOS4ujoke3RoaXMuZmllbGQuYWNjZXB0fSzkuJTlkI7nvIDlkI3kuLo6JHt0aGlzLmZpZWxkLmZvcm1hdH1gLAogICAgICAgICAgICAgICAgZHVyYXRpb246IDIsCiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgb25FeGNlZWRlZFNpemUoKSB7CiAgICAgICAgICAgIHRoaXMuJE1lc3NhZ2UuZXJyb3IoewogICAgICAgICAgICAgICAgY29udGVudDogYOS4iuS8oOaWh+S7tuWkp+Wwj+S4jeiDvei2hei/hzoke3RoaXMuZmllbGQubWF4U2l6ZSAvIDEwMjR9TUJgLAogICAgICAgICAgICAgICAgZHVyYXRpb246IDIsCiAgICAgICAgICAgIH0pOwogICAgICAgIH0sCiAgICAgICAgb25SZW1vdmUoKSB7CiAgICAgICAgICAgIHRoaXMudXBsb2FkRmlsZUxpc3QgPSB0aGlzLnVwbG9hZGVyLmZpbGVMaXN0LnNsaWNlKCk7CiAgICAgICAgICAgIHRoaXMuaGFuZGxlQ2hhbmdlKCk7CiAgICAgICAgfQogICAgfQp9Owo="},{"version":3,"sources":["fieldUpload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"fieldUpload.vue","sourceRoot":"node_modules/form-generator-iview/src/fields","sourcesContent":["<template>\n    <Upload\n        ref=\"upload\"\n        :action=\"field.action\"\n        :headers=\"field.headers\"\n        :multiple=\"field.multiple\"\n        :paste=\"field.paste\"\n        :disabled=\"field.disabled\"\n        :data=\"field.data\"\n        :name=\"field.name\"\n        :with-credentials=\"field.withCredentials\"\n        :show-upload-list=\"field.showUploadList\"\n        :type=\"field.subtype\"\n        :accept=\"field.accept\"\n        :format=\"field.format\"\n        :max-size=\"field.maxSize\"\n        :default-file-list=\"[]\"\n        :on-format-error=\"onFormatError\"\n        :on-exceeded-size=\"onExceededSize\"\n        :on-success=\"onSuccess\"\n        :on-remove=\"onRemove\"\n        :size=\"size\"\n    >\n        <Icon\n            type=\"ios-cloud-upload\"\n            size=\"52\"\n            style=\"color: #3399ff\"\n        />\n        <p v-html=\"tip\" />\n    </Upload>\n</template>\n<script>\n\nexport default {\n    inject: ['form'],\n    props: {\n        field: {\n            type: Object,\n            required: true\n        },\n        size: {\n            type: String,\n            default() {\n                return 'default';\n            }\n        },\n    },\n    data() {\n        return {\n            defaultFileList: [],\n            uploadFileList: [],\n            loading: false,\n            uploader: null\n        };\n    },\n    computed: {\n        tip() {\n            return this.field.tip || '点击或者拖拽文件即可上传';\n        },\n        value() {\n            let value = this.form.model[this.field.model] || [];\n            return value.map(item => {\n                item.status = 'finished';\n                return item;\n            });\n        }\n    },\n    watch: {\n        value(value) {\n            this.uploadFileList = value;\n            if (this.uploader) {\n                this.uploader.fileList = this.uploadFileList;\n            }\n        },\n    },\n    mounted() {\n        this.uploader = this.$refs.upload || this.$refs.mediaUpload.$refs.upload;\n        this.uploader.fileList = this.value;\n        this.uploadFileList = this.uploader.fileList;\n        // this.uploader.fileList = this.uploadFileList;\n    },\n    methods: {\n        handleChange() {\n            this.$set(this.form.model, this.field.model, this.uploadFileList);\n            this.$emit('on-change', this.field.model, this.uploadFileList, null, this.field);\n        },\n        onSuccess({data = {}}, file) {\n            const {url} = data;\n            if (url) {\n                this.$Message.info('上传成功!');\n                file.url = url;\n                this.uploadFileList = this.uploader.fileList.slice();\n                this.handleChange();\n            }\n            else {\n                this.$Message.error('上传失败!');\n            }\n        },\n        onFormatError() {\n            this.$Message.error({\n                content: `上传文件格式需为:${this.field.accept},且后缀名为:${this.field.format}`,\n                duration: 2,\n            });\n        },\n        onExceededSize() {\n            this.$Message.error({\n                content: `上传文件大小不能超过:${this.field.maxSize / 1024}MB`,\n                duration: 2,\n            });\n        },\n        onRemove() {\n            this.uploadFileList = this.uploader.fileList.slice();\n            this.handleChange();\n        }\n    }\n};\n</script>\n"]}]}